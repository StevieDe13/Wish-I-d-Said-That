<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#fffbf0">
<title>Wish I'd Said That! üí¨</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #fffbf0;
    --yellow: #ffd93d;
    --orange: #ff6b35;
    --pink: #ff4d8d;
    --teal: #00c9a7;
    --purple: #7c5cbf;
    --dark: #2d2640;
    --card: #ffffff;
    --shadow: rgba(45,38,64,0.12);
    --border: rgba(45,38,64,0.08);
  }

  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--dark);
    min-height: 100vh;
    min-height: 100dvh;
    overflow-x: hidden;
  }

  /* Fun background pattern */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      radial-gradient(circle at 20% 20%, rgba(255,217,61,0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(255,77,141,0.12) 0%, transparent 50%),
      radial-gradient(circle at 60% 20%, rgba(0,201,167,0.1) 0%, transparent 40%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 480px;
    margin: 0 auto;
    padding: 0 20px env(safe-area-inset-bottom, 20px);
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  .header {
    padding: 24px 0 8px;
    text-align: center;
  }

  .header-emoji {
    font-size: 3rem;
    display: block;
    animation: wobble 3s ease-in-out infinite;
    line-height: 1;
    margin-bottom: 8px;
  }

  @keyframes wobble {
    0%,100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
  }

  .app-title {
    font-family: 'Fredoka One', cursive;
    font-size: 2.2rem;
    color: var(--dark);
    line-height: 1;
    letter-spacing: 0.01em;
  }

  .app-title span { color: var(--orange); }

  .app-subtitle {
    font-size: 0.88rem;
    color: rgba(45,38,64,0.55);
    margin-top: 6px;
    font-weight: 600;
  }

  /* Situation types */
  .situation-types {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    margin: 20px 0 16px;
  }

  .type-chip {
    padding: 7px 14px;
    border-radius: 100px;
    border: 2px solid var(--border);
    background: white;
    font-family: 'Nunito', sans-serif;
    font-size: 0.78rem;
    font-weight: 700;
    color: rgba(45,38,64,0.6);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .type-chip.selected {
    border-color: var(--orange);
    background: var(--orange);
    color: white;
    transform: scale(1.05);
  }

  .type-chip:active { transform: scale(0.96); }

  /* Input area */
  .input-card {
    background: white;
    border-radius: 24px;
    padding: 20px;
    box-shadow: 0 4px 20px var(--shadow);
    border: 2px solid var(--border);
    margin-bottom: 16px;
  }

  .input-label {
    font-size: 0.72rem;
    font-weight: 800;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(45,38,64,0.4);
    margin-bottom: 10px;
    display: block;
  }

  .situation-input {
    width: 100%;
    border: 2px solid rgba(45,38,64,0.1);
    border-radius: 16px;
    padding: 14px 16px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--dark);
    background: var(--bg);
    resize: none;
    outline: none;
    transition: border-color 0.2s;
    min-height: 90px;
  }

  .situation-input:focus { border-color: var(--orange); }
  .situation-input::placeholder { color: rgba(45,38,64,0.3); font-weight: 600; }

  .generate-btn {
    width: 100%;
    height: 58px;
    border-radius: 16px;
    border: none;
    background: linear-gradient(135deg, var(--orange), var(--pink));
    color: white;
    font-family: 'Fredoka One', cursive;
    font-size: 1.2rem;
    letter-spacing: 0.02em;
    cursor: pointer;
    margin-top: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 4px 16px rgba(255,107,53,0.35);
    transition: all 0.2s;
  }

  .generate-btn:active { transform: scale(0.97); }

  /* Result card */
  .result-card {
    background: white;
    border-radius: 24px;
    padding: 24px;
    box-shadow: 0 4px 24px var(--shadow);
    border: 2px solid var(--border);
    margin-bottom: 16px;
    display: none;
    animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }

  .result-card.show { display: block; }

  @keyframes popIn {
    0% { transform: scale(0.85); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }

  .result-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(255,107,53,0.1);
    color: var(--orange);
    border-radius: 100px;
    padding: 4px 12px;
    font-size: 0.72rem;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 14px;
  }

  .speech-bubble {
    background: linear-gradient(135deg, #fff9f0, #fff0f5);
    border: 2px solid rgba(255,107,53,0.15);
    border-radius: 20px 20px 20px 4px;
    padding: 18px 20px;
    margin-bottom: 16px;
    position: relative;
  }

  .speech-bubble::before {
    content: '"';
    font-family: 'Fredoka One', cursive;
    font-size: 4rem;
    color: rgba(255,107,53,0.15);
    position: absolute;
    top: -8px;
    left: 12px;
    line-height: 1;
  }

  .result-text {
    font-family: 'Fredoka One', cursive;
    font-size: 1.25rem;
    color: var(--dark);
    line-height: 1.4;
    letter-spacing: 0.01em;
  }

  .result-context {
    font-size: 0.8rem;
    color: rgba(45,38,64,0.5);
    font-weight: 600;
    font-style: italic;
    margin-top: 8px;
  }

  /* Action buttons */
  .result-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .act-btn {
    flex: 1;
    min-width: 80px;
    height: 44px;
    border-radius: 12px;
    border: 2px solid var(--border);
    background: white;
    color: rgba(45,38,64,0.6);
    font-family: 'Nunito', sans-serif;
    font-size: 0.82rem;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    transition: all 0.2s;
  }

  .act-btn:active { transform: scale(0.95); }
  .act-btn.save-btn:hover { border-color: var(--pink); color: var(--pink); }
  .act-btn.copy-btn:hover { border-color: var(--teal); color: var(--teal); }
  .act-btn.another-btn {
    background: linear-gradient(135deg, var(--teal), #00a886);
    border-color: transparent;
    color: white;
    box-shadow: 0 3px 12px rgba(0,201,167,0.3);
  }

  /* Random button */
  .random-btn {
    width: 100%;
    height: 52px;
    border-radius: 16px;
    border: 2px dashed rgba(45,38,64,0.2);
    background: transparent;
    color: rgba(45,38,64,0.5);
    font-family: 'Nunito', sans-serif;
    font-size: 0.88rem;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
    margin-bottom: 16px;
  }

  .random-btn:hover { border-color: var(--purple); color: var(--purple); background: rgba(124,92,191,0.05); }
  .random-btn:active { transform: scale(0.97); }

  /* Saved section */
  .saved-section {
    margin-bottom: 24px;
  }

  .saved-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .saved-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem;
    color: var(--dark);
  }

  .clear-btn {
    font-size: 0.72rem;
    font-weight: 700;
    color: rgba(45,38,64,0.35);
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 8px;
  }

  .saved-item {
    background: white;
    border-radius: 16px;
    padding: 14px 16px;
    margin-bottom: 8px;
    border: 2px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { transform: translateX(-10px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  .saved-text {
    font-family: 'Fredoka One', cursive;
    font-size: 0.92rem;
    color: var(--dark);
    line-height: 1.4;
    flex: 1;
  }

  .saved-tag {
    font-size: 0.65rem;
    font-weight: 800;
    color: var(--orange);
    background: rgba(255,107,53,0.1);
    padding: 2px 8px;
    border-radius: 100px;
    white-space: nowrap;
    margin-top: 2px;
  }

  .del-btn {
    background: none;
    border: none;
    color: rgba(45,38,64,0.25);
    cursor: pointer;
    font-size: 1rem;
    padding: 2px;
    flex-shrink: 0;
  }

  .no-saved {
    text-align: center;
    color: rgba(45,38,64,0.35);
    font-size: 0.85rem;
    font-weight: 600;
    padding: 16px 0;
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 24px);
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--dark);
    color: white;
    padding: 12px 24px;
    border-radius: 100px;
    font-size: 0.85rem;
    font-weight: 700;
    white-space: nowrap;
    z-index: 100;
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
    pointer-events: none;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Loading state */
  .generating {
    display: none;
    text-align: center;
    padding: 20px;
    color: rgba(45,38,64,0.5);
    font-weight: 700;
    font-size: 0.9rem;
  }
  .generating.show { display: block; }
  .generating span { animation: dots 1.2s infinite; display: inline-block; }
  .generating span:nth-child(2) { animation-delay: 0.2s; }
  .generating span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes dots { 0%,80%,100%{transform:scale(0)} 40%{transform:scale(1)} }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <span class="header-emoji">üí¨</span>
    <h1 class="app-title">Wish I'd Said <span>That!</span></h1>
    <p class="app-subtitle">The perfect comeback ‚Äî three hours too late üòÖ</p>
  </div>

  <!-- Situation type chips -->
  <div class="situation-types">
    <button class="type-chip selected" onclick="selectType(this, 'general')">üòÖ Any situation</button>
    <button class="type-chip" onclick="selectType(this, 'boss')">üëî Boss/work</button>
    <button class="type-chip" onclick="selectType(this, 'family')">üë®‚Äçüë©‚Äçüëß Family</button>
    <button class="type-chip" onclick="selectType(this, 'friend')">üôÉ Friends</button>
    <button class="type-chip" onclick="selectType(this, 'stranger')">üõí Strangers</button>
    <button class="type-chip" onclick="selectType(this, 'date')">üíò Dating</button>
  </div>

  <!-- Input -->
  <div class="input-card">
    <label class="input-label">What happened? üëá</label>
    <textarea 
      class="situation-input" 
      id="situationInput"
      placeholder="e.g. My boss said my idea was 'interesting' in that tone..."
      maxlength="300"
    ></textarea>
    <button class="generate-btn" onclick="generate()">
      ‚ú® What should I have said?
    </button>
  </div>

  <!-- Random -->
  <button class="random-btn" onclick="randomLine()">
    üé≤ Just give me something funny
  </button>

  <!-- Generating indicator -->
  <div class="generating" id="generating">
    Cooking up something brilliant<span>.</span><span>.</span><span>.</span>
  </div>

  <!-- Result -->
  <div class="result-card" id="resultCard">
    <div class="result-tag" id="resultTag">üí° What you should have said</div>
    <div class="speech-bubble">
      <div class="result-text" id="resultText"></div>
      <div class="result-context" id="resultContext"></div>
    </div>
    <div class="result-actions">
      <button class="act-btn save-btn" onclick="saveLine()">‚ô° Save</button>
      <button class="act-btn copy-btn" onclick="copyLine()">‚éò Copy</button>
      <button class="act-btn another-btn" onclick="generate()">‚Ü∫ Another</button>
    </div>
  </div>

  <!-- Saved -->
  <div class="saved-section" id="savedSection" style="display:none">
    <div class="saved-header">
      <div class="saved-title">‚≠ê Your best lines</div>
      <button class="clear-btn" onclick="clearAll()">Clear all</button>
    </div>
    <div id="savedList"></div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let selectedType = 'general';
let currentLine = '';
let currentContext = '';
let savedLines = [];

// Load saved lines from localStorage
try { savedLines = JSON.parse(localStorage.getItem('wishid-saved') || '[]'); } catch(e) { savedLines = []; }
renderSaved();

// ‚îÄ‚îÄ Situation type selector ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectType(btn, type) {
  document.querySelectorAll('.type-chip').forEach(c => c.classList.remove('selected'));
  btn.classList.add('selected');
  selectedType = type;
}

// ‚îÄ‚îÄ Lines database ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const linesByType = {
  boss: [
    { line: `You're absolutely right. I'll go home tonight, stare at the ceiling, and fundamentally reassess my entire existence. Should take about forty minutes.`, context: `After being corrected at work` },
    { line: `Oh, I didn't realise we were doing performance reviews in the hallway now! Should I get a chair or is this a standing humiliation?`, context: `Criticised in front of others` },
    { line: `That's a great note. I'm going to write it down, lose the paper, find it in six months, and feel bad all over again.`, context: `Feedback you didn't ask for` },
    { line: `Absolutely, I'll get right on that. Right after I finish pretending I have any idea what I'm doing.`, context: `Given an impossible task` },
    { line: `I completely understand. You want it faster, better, and cheaper. Wonderful. I'll just briefly become a different person.`, context: `Unreasonable expectations` },
    { line: `You're so right. I have no idea why I thought that was a good idea. Neither does anyone else, but at least we're all confused together.`, context: `Idea gets shot down` },
    { line: `I appreciate the feedback! I've stored it in the same place I keep my sense of professional confidence. So it's gone.`, context: `Harsh review` },
    { line: `Great point. I'll add it to the mounting pile of evidence that I peaked in year nine.`, context: `Made to feel incompetent` },
    { line: `Could you send that in an email? I want to read it at 2am when I'm already in a shame spiral.`, context: `Criticism delivered verbally` },
    { line: `Noted! I'll implement those changes right after I work out which version of me is showing up tomorrow.`, context: `Told to do things differently` },
  ],
  family: [
    { line: `You're absolutely right. I don't know how I've survived this long without your input. It's genuinely baffling.`, context: `Unsolicited life advice` },
    { line: `Oh good, we're doing the thing where everyone has opinions about my life! Can I get a number? Is there a queue?`, context: `Family ganging up on you` },
    { line: `Yes, I know cousin Sharon bought a house. I also know I ate cereal for dinner last night. We're on very different journeys.`, context: `Being compared to a relative` },
    { line: `I appreciate that. I really do. And I'm going to think about it for the entire drive home and then never again.`, context: `Advice you'll never take` },
    { line: `Mum, I love you with my whole heart and I need you to stop talking right now for both our sakes.`, context: `Mum going on and on` },
    { line: `That's a fair point actually. I'm choosing to be offended anyway because I'm emotionally consistent.`, context: `When they're annoyingly right` },
    { line: `Yes, I'm aware. I'm also aware of seventeen other things I should be doing differently. I'm managing a very full calendar of regrets.`, context: `Being reminded of your failings` },
    { line: `I will absolutely take that on board. The board is currently full but I'll see if I can squeeze it in next to my other unresolved issues.`, context: `Too much advice at once` },
    { line: `You know what, you're right. I've been going about this whole 'being a person' thing completely wrong. Thanks for clearing that up at Christmas dinner.`, context: `Holiday family advice` },
    { line: `I turned out fine! Debatable, yes. But fine. Mostly fine. Fine-adjacent.`, context: `When your upbringing is criticised` },
  ],
  friend: [
    { line: `You know what I love about you? You always say the quiet part loud and the loud part louder.`, context: `Overly honest friend` },
    { line: `That is such a good point and I resent you for it.`, context: `When they're annoyingly right` },
    { line: `I hear you. I really do. And I'm going to do the exact opposite and then call you crying in three weeks.`, context: `Good advice you won't follow` },
    { line: `Bold of you to assume I've thought this through. I am operating entirely on vibes and blind optimism.`, context: `Called out for being impulsive` },
    { line: `You're my best friend. You are also the leading cause of my worst decisions. These things coexist peacefully.`, context: `Mutual chaos energy` },
    { line: `I love that you think I have a plan. That is genuinely the funniest thing you've ever said to me.`, context: `Asked about your plans` },
    { line: `Wow, you really committed to saying that out loud, didn't you. Respect. Misguided, but respect.`, context: `Unnecessary honesty from a friend` },
    { line: `That's fair. That's so fair. I hate that it's fair. Why is it fair. Stop being fair.`, context: `When they make a good point` },
    { line: `I'm not avoiding the problem, I'm just giving it space to sort itself out. It hasn't yet but I remain optimistic.`, context: `Called out for avoiding something` },
    { line: `You know what, let's just never speak of this again and pretend we're both doing great.`, context: `After an uncomfortable truth` },
  ],
  stranger: [
    { line: `Thank you! I was worried no one would comment on that today and now I can relax.`, context: `Stranger's unsolicited opinion` },
    { line: `Wow. You looked at me, assessed the situation, and decided that was the right thing to say. Remarkable.`, context: `Rude comment from a stranger` },
    { line: `I appreciate you. I appreciate you the way I appreciate roadworks ‚Äî you're there, you're unavoidable, and I can't wait until you're not.`, context: `Annoying stranger` },
    { line: `That's so kind! I'm going to carry that with me for about eleven steps and then release it into the universe.`, context: `Comment you're brushing off` },
    { line: `You smile more. I'll smile when something's funny. We'll meet in the middle eventually.`, context: `Told to smile by a stranger` },
    { line: `I can see you have a lot of thoughts about this. I hope that brings you peace.`, context: `Stranger with strong opinions` },
    { line: `Oh, are we talking? I didn't realise we were talking. I was just standing here being a person.`, context: `Unwanted conversation` },
    { line: `What a fascinating thing to say to a complete stranger! You must be so fun at parties. Or not invited to them.`, context: `Rude stranger in public` },
    { line: `I'm going to take a big step back and then keep walking until I can't see you anymore.`, context: `Stranger overstaying their welcome` },
    { line: `Noted! I'll factor that into absolutely nothing and continue with my day.`, context: `Any unsolicited stranger comment` },
  ],
  date: [
    { line: `Oh that's so interesting! You know what else is interesting? The door. It's right there. Fascinating structure.`, context: `Major red flag on a first date` },
    { line: `I'm having a really nice time! That's not entirely true but I've committed to this sentence now.`, context: `Mediocre date energy` },
    { line: `You talk about your ex the way I talk about a TV show I'm still not over. Which is fine. Totally fine. This is fine.`, context: `Date mentions their ex again` },
    { line: `I love that for you. I love your confidence. I love that you think this is going well.`, context: `Date seems oblivious` },
    { line: `You know what, I think we'd be great friends. From a distance. Texting occasionally. Maybe never.`, context: `No romantic connection` },
    { line: `That's such a great story! It has everything. A beginning, a middle, and me mentally redecorating my flat.`, context: `Date won't stop talking` },
    { line: `I'm getting a very clear picture of who you are and I'm choosing not to hang it anywhere.`, context: `Revealing comment on a date` },
    { line: `Wow you're really honest on a first date aren't you. That's brave. Unhinged, but brave.`, context: `Too much information too soon` },
    { line: `I had a wonderful evening! That's a generous description but I'm going with it.`, context: `Polite goodbye after bad date` },
    { line: `You know what, I think we want different things. You want someone who's impressed by that. I want dinner.`, context: `Date shows off too much` },
  ],
  general: [
    { line: `I'm going to need a moment. Not a short moment. A long one. Possibly in a different country.`, context: `Something completely unexpected` },
    { line: `That's such a good point. I'm going to ignore it so hard.`, context: `When someone's right and you hate it` },
    { line: `I would respond to that but I've already used up my daily allocation of dealing with things.`, context: `Too much at once` },
    { line: `Wow, you really committed to that opinion. No helmet, no parachute, just full speed into the void.`, context: `Someone very confident and wrong` },
    { line: `I'm sorry, I was distracted by the extremely loud sound of me not asking for that.`, context: `Unsolicited opinion` },
    { line: `That's fair. That's so fair. I'm going to be annoyed about it for six to eight business days and then quietly admit you were right.`, context: `Accurate criticism` },
    { line: `I appreciate you saying that! I'm going to put it in my pocket, walk outside, and let the wind take it.`, context: `Unhelpful comment` },
    { line: `You know what's great about this situation? Nothing yet, but I'm manifesting.`, context: `Things going badly` },
    { line: `I had a whole response planned but then I remembered I don't have the energy and neither does anyone here.`, context: `Not worth arguing about` },
    { line: `That landed differently than you intended, didn't it. It's okay. We've all been there. Some of us live there.`, context: `Awkward comment` },
    { line: `I'm choosing to interpret that as a compliment and sprint away before anyone corrects me.`, context: `Ambiguous comment` },
    { line: `Absolutely! I'll get right on that just as soon as I finish my current task of slowly unravelling.`, context: `Asked to do more things` },
    { line: `You raise a great point and I am going to think about it for approximately one second and then make the same mistake again.`, context: `Good advice` },
    { line: `Noted! Filed under things that will not be affecting my evening, my week, or my general outlook on life.`, context: `Minor criticism` },
    { line: `I love that you think I have this handled. That makes one of us and I find it very comforting.`, context: `When someone assumes you're fine` },
  ]
};

// Situation-based response templates
const situationResponses = {
  ignored: [
    `Sorry, I was just mapping out all the ways to exit this conversation.`,
    `Hold on, I'm composing my response in a language you'll actually hear.`,
    `I was going to say something but then I remembered: why bother.`,
  ],
  late: [
    `I'm not late. Everyone else is just aggressively early.`,
    `Time is a social construct and I refuse to be bound by your constructs.`,
    `I was here in spirit the whole time. My body just takes longer.`,
  ],
  boring: [
    `Wow, this is fascinating. I'm so glad I woke up today.`,
    `Please keep going. I'm listening so hard right now.`,
    `I'm riveted. Truly. This is the best use of everyone's time.`,
  ],
  rude: [
    `I'm sorry, I think your filter fell off. Do you need a moment to find it?`,
    `Interesting choice of words! Really bold. Unasked for but bold.`,
    `I'm going to give you the gift of pretending you didn't just say that.`,
  ],
  comparison: [
    `Oh you're comparing me to other people? How original! How classic! How very you!`,
    `Noted! I'll add that to my list of comparisons I didn't ask for and won't be using.`,
    `Wonderful! We're all on different journeys and mine apparently includes this conversation.`,
  ],
};

function detectSituationKeywords(text) {
  const t = text.toLowerCase();
  if (t.includes('ignor') || t.includes('didn\'t listen') || t.includes('not listening')) return 'ignored';
  if (t.includes('late') || t.includes('early') || t.includes('time')) return 'late';
  if (t.includes('boring') || t.includes('long story') || t.includes('wouldn\'t stop talking')) return 'boring';
  if (t.includes('rude') || t.includes('mean') || t.includes('said something') || t.includes('called me')) return 'rude';
  if (t.includes('compared') || t.includes('why can\'t you') || t.includes('should be more like')) return 'comparison';
  return null;
}

function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

let lastIndex = -1;

function getLineForType(type) {
  const lines = linesByType[type] || linesByType.general;
  let idx;
  do { idx = Math.floor(Math.random() * lines.length); } while (idx === lastIndex && lines.length > 1);
  lastIndex = idx;
  return lines[idx];
}

function generate() {
  const input = document.getElementById('situationInput').value.trim();
  
  // Show generating state
  document.getElementById('generating').classList.add('show');
  document.getElementById('resultCard').classList.remove('show');

  setTimeout(() => {
    document.getElementById('generating').classList.remove('show');

    let result;

    if (input.length > 5) {
      // Try to match situation keywords first
      const keyword = detectSituationKeywords(input);
      if (keyword && Math.random() > 0.4) {
        result = {
          line: pick(situationResponses[keyword]),
          context: `For your situation`
        };
      } else {
        result = getLineForType(selectedType);
      }
    } else {
      result = getLineForType(selectedType);
    }

    currentLine = result.line;
    currentContext = result.context;

    document.getElementById('resultText').textContent = result.line;
    document.getElementById('resultContext').textContent = result.context;
    document.getElementById('resultCard').classList.add('show');

  }, 600 + Math.random() * 400);
}

function randomLine() {
  document.getElementById('situationInput').value = '';
  const allTypes = Object.keys(linesByType);
  const randomType = pick(allTypes);
  const result = getLineForType(randomType);
  currentLine = result.line;
  currentContext = result.context;

  document.getElementById('generating').classList.add('show');
  document.getElementById('resultCard').classList.remove('show');

  setTimeout(() => {
    document.getElementById('generating').classList.remove('show');
    document.getElementById('resultText').textContent = result.line;
    document.getElementById('resultContext').textContent = result.context;
    document.getElementById('resultCard').classList.add('show');
  }, 500);
}

// ‚îÄ‚îÄ Save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveLine() {
  if (!currentLine) return;
  if (savedLines.find(s => s.line === currentLine)) { showToast('Already saved! ‚≠ê'); return; }
  savedLines.unshift({ line: currentLine, context: currentContext, type: selectedType });
  localStorage.setItem('wishid-saved', JSON.stringify(savedLines));
  renderSaved();
  showToast('Saved to your best lines! ‚≠ê');
}

function deleteSaved(i) {
  savedLines.splice(i, 1);
  localStorage.setItem('wishid-saved', JSON.stringify(savedLines));
  renderSaved();
}

function clearAll() {
  if (!confirm('Clear all saved lines?')) return;
  savedLines = [];
  localStorage.setItem('wishid-saved', JSON.stringify(savedLines));
  renderSaved();
}

function renderSaved() {
  const section = document.getElementById('savedSection');
  const list = document.getElementById('savedList');
  if (savedLines.length === 0) {
    section.style.display = 'none';
    return;
  }
  section.style.display = 'block';
  list.innerHTML = savedLines.map((s, i) => `
    <div class="saved-item">
      <div style="flex:1">
        <div class="saved-text">${s.line}</div>
        <div class="saved-tag">${s.context}</div>
      </div>
      <button class="del-btn" onclick="deleteSaved(${i})">‚úï</button>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ Copy ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function copyLine() {
  if (!currentLine) return;
  navigator.clipboard.writeText(currentLine).then(() => showToast('Copied! üìã')).catch(() => showToast('Copy failed'));
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// Allow Enter key to generate (but Shift+Enter for new line)
document.getElementById('situationInput').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); generate(); }
});
</script>
</body>
</html>
