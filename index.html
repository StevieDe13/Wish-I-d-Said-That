<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#fffbf0">
<title>Wish I'd Said That! üí¨</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #fffbf0;
    --yellow: #ffd93d;
    --orange: #ff6b35;
    --pink: #ff4d8d;
    --teal: #00c9a7;
    --purple: #7c5cbf;
    --dark: #2d2640;
    --card: #ffffff;
    --shadow: rgba(45,38,64,0.12);
    --border: rgba(45,38,64,0.08);
  }

  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--dark);
    min-height: 100vh;
    min-height: 100dvh;
    overflow-x: hidden;
  }

  /* Fun background pattern */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: 
      radial-gradient(circle at 20% 20%, rgba(255,217,61,0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(255,77,141,0.12) 0%, transparent 50%),
      radial-gradient(circle at 60% 20%, rgba(0,201,167,0.1) 0%, transparent 40%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 480px;
    margin: 0 auto;
    padding: 0 20px env(safe-area-inset-bottom, 20px);
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  /* Header */
  .header {
    padding: 24px 0 8px;
    text-align: center;
  }

  .header-emoji {
    font-size: 3rem;
    display: block;
    animation: wobble 3s ease-in-out infinite;
    line-height: 1;
    margin-bottom: 8px;
  }

  @keyframes wobble {
    0%,100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
  }

  .app-title {
    font-family: 'Fredoka One', cursive;
    font-size: 2.2rem;
    color: var(--dark);
    line-height: 1;
    letter-spacing: 0.01em;
  }

  .app-title span { color: var(--orange); }

  .app-subtitle {
    font-size: 0.88rem;
    color: rgba(45,38,64,0.55);
    margin-top: 6px;
    font-weight: 600;
  }

  /* Situation types */
  .situation-types {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    margin: 20px 0 16px;
  }

  .type-chip {
    padding: 7px 14px;
    border-radius: 100px;
    border: 2px solid var(--border);
    background: white;
    font-family: 'Nunito', sans-serif;
    font-size: 0.78rem;
    font-weight: 700;
    color: rgba(45,38,64,0.6);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .type-chip.selected {
    border-color: var(--orange);
    background: var(--orange);
    color: white;
    transform: scale(1.05);
  }

  .type-chip:active { transform: scale(0.96); }

  /* Input area */
  .input-card {
    background: white;
    border-radius: 24px;
    padding: 20px;
    box-shadow: 0 4px 20px var(--shadow);
    border: 2px solid var(--border);
    margin-bottom: 16px;
  }

  .input-label {
    font-size: 0.72rem;
    font-weight: 800;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: rgba(45,38,64,0.4);
    margin-bottom: 10px;
    display: block;
  }

  .situation-input {
    width: 100%;
    border: 2px solid rgba(45,38,64,0.1);
    border-radius: 16px;
    padding: 14px 16px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--dark);
    background: var(--bg);
    resize: none;
    outline: none;
    transition: border-color 0.2s;
    min-height: 90px;
  }

  .situation-input:focus { border-color: var(--orange); }
  .situation-input::placeholder { color: rgba(45,38,64,0.3); font-weight: 600; }

  .generate-btn {
    width: 100%;
    height: 58px;
    border-radius: 16px;
    border: none;
    background: linear-gradient(135deg, var(--orange), var(--pink));
    color: white;
    font-family: 'Fredoka One', cursive;
    font-size: 1.2rem;
    letter-spacing: 0.02em;
    cursor: pointer;
    margin-top: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 4px 16px rgba(255,107,53,0.35);
    transition: all 0.2s;
  }

  .generate-btn:active { transform: scale(0.97); }

  /* Result card */
  .result-card {
    background: white;
    border-radius: 24px;
    padding: 24px;
    box-shadow: 0 4px 24px var(--shadow);
    border: 2px solid var(--border);
    margin-bottom: 16px;
    display: none;
    animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }

  .result-card.show { display: block; }

  @keyframes popIn {
    0% { transform: scale(0.85); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }

  .result-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(255,107,53,0.1);
    color: var(--orange);
    border-radius: 100px;
    padding: 4px 12px;
    font-size: 0.72rem;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 14px;
  }

  .speech-bubble {
    background: linear-gradient(135deg, #fff9f0, #fff0f5);
    border: 2px solid rgba(255,107,53,0.15);
    border-radius: 20px 20px 20px 4px;
    padding: 18px 20px;
    margin-bottom: 16px;
    position: relative;
  }

  .speech-bubble::before {
    content: '"';
    font-family: 'Fredoka One', cursive;
    font-size: 4rem;
    color: rgba(255,107,53,0.15);
    position: absolute;
    top: -8px;
    left: 12px;
    line-height: 1;
  }

  .result-text {
    font-family: 'Fredoka One', cursive;
    font-size: 1.25rem;
    color: var(--dark);
    line-height: 1.4;
    letter-spacing: 0.01em;
  }

  .result-context {
    font-size: 0.8rem;
    color: rgba(45,38,64,0.5);
    font-weight: 600;
    font-style: italic;
    margin-top: 8px;
  }

  /* Action buttons */
  .result-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .act-btn {
    flex: 1;
    min-width: 80px;
    height: 44px;
    border-radius: 12px;
    border: 2px solid var(--border);
    background: white;
    color: rgba(45,38,64,0.6);
    font-family: 'Nunito', sans-serif;
    font-size: 0.82rem;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    transition: all 0.2s;
  }

  .act-btn:active { transform: scale(0.95); }
  .act-btn.save-btn:hover { border-color: var(--pink); color: var(--pink); }
  .act-btn.copy-btn:hover { border-color: var(--teal); color: var(--teal); }
  .act-btn.another-btn {
    background: linear-gradient(135deg, var(--teal), #00a886);
    border-color: transparent;
    color: white;
    box-shadow: 0 3px 12px rgba(0,201,167,0.3);
  }

  /* Random button */
  .random-btn {
    width: 100%;
    height: 52px;
    border-radius: 16px;
    border: 2px dashed rgba(45,38,64,0.2);
    background: transparent;
    color: rgba(45,38,64,0.5);
    font-family: 'Nunito', sans-serif;
    font-size: 0.88rem;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
    margin-bottom: 16px;
  }

  .random-btn:hover { border-color: var(--purple); color: var(--purple); background: rgba(124,92,191,0.05); }
  .random-btn:active { transform: scale(0.97); }

  /* Saved section */
  .saved-section {
    margin-bottom: 24px;
  }

  .saved-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .saved-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem;
    color: var(--dark);
  }

  .clear-btn {
    font-size: 0.72rem;
    font-weight: 700;
    color: rgba(45,38,64,0.35);
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 8px;
  }

  .saved-item {
    background: white;
    border-radius: 16px;
    padding: 14px 16px;
    margin-bottom: 8px;
    border: 2px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { transform: translateX(-10px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  .saved-text {
    font-family: 'Fredoka One', cursive;
    font-size: 0.92rem;
    color: var(--dark);
    line-height: 1.4;
    flex: 1;
  }

  .saved-tag {
    font-size: 0.65rem;
    font-weight: 800;
    color: var(--orange);
    background: rgba(255,107,53,0.1);
    padding: 2px 8px;
    border-radius: 100px;
    white-space: nowrap;
    margin-top: 2px;
  }

  .del-btn {
    background: none;
    border: none;
    color: rgba(45,38,64,0.25);
    cursor: pointer;
    font-size: 1rem;
    padding: 2px;
    flex-shrink: 0;
  }

  .no-saved {
    text-align: center;
    color: rgba(45,38,64,0.35);
    font-size: 0.85rem;
    font-weight: 600;
    padding: 16px 0;
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: calc(env(safe-area-inset-bottom, 0px) + 24px);
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--dark);
    color: white;
    padding: 12px 24px;
    border-radius: 100px;
    font-size: 0.85rem;
    font-weight: 700;
    white-space: nowrap;
    z-index: 100;
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
    pointer-events: none;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Loading state */
  .generating {
    display: none;
    text-align: center;
    padding: 20px;
    color: rgba(45,38,64,0.5);
    font-weight: 700;
    font-size: 0.9rem;
  }
  .generating.show { display: block; }
  .generating span { animation: dots 1.2s infinite; display: inline-block; }
  .generating span:nth-child(2) { animation-delay: 0.2s; }
  .generating span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes dots { 0%,80%,100%{transform:scale(0)} 40%{transform:scale(1)} }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <span class="header-emoji">üí¨</span>
    <h1 class="app-title">Wish I'd Said <span>That!</span></h1>
    <p class="app-subtitle">The perfect comeback ‚Äî three hours too late üòÖ</p>
  </div>

  <!-- Situation type chips -->
  <div class="situation-types">
    <button class="type-chip selected" onclick="selectType(this, 'general')">üòÖ Any situation</button>
    <button class="type-chip" onclick="selectType(this, 'boss')">üëî Boss/work</button>
    <button class="type-chip" onclick="selectType(this, 'family')">üë®‚Äçüë©‚Äçüëß Family</button>
    <button class="type-chip" onclick="selectType(this, 'friend')">üôÉ Friends</button>
    <button class="type-chip" onclick="selectType(this, 'stranger')">üõí Strangers</button>
    <button class="type-chip" onclick="selectType(this, 'date')">üíò Dating</button>
  </div>

  <!-- Input -->
  <div class="input-card">
    <label class="input-label">What happened? üëá</label>
    <textarea 
      class="situation-input" 
      id="situationInput"
      placeholder="e.g. My boss said my idea was 'interesting' in that tone..."
      maxlength="300"
    ></textarea>
    <button class="generate-btn" onclick="generate()">
      ‚ú® What should I have said?
    </button>
  </div>

  <!-- Random -->
  <button class="random-btn" onclick="randomLine()">
    üé≤ Just give me something funny
  </button>

  <!-- Generating indicator -->
  <div class="generating" id="generating">
    Cooking up something brilliant<span>.</span><span>.</span><span>.</span>
  </div>

  <!-- Result -->
  <div class="result-card" id="resultCard">
    <div class="result-tag" id="resultTag">üí° What you should have said</div>
    <div class="speech-bubble">
      <div class="result-text" id="resultText"></div>
      <div class="result-context" id="resultContext"></div>
    </div>
    <div class="result-actions">
      <button class="act-btn save-btn" onclick="saveLine()">‚ô° Save</button>
      <button class="act-btn copy-btn" onclick="copyLine()">‚éò Copy</button>
      <button class="act-btn another-btn" onclick="generate()">‚Ü∫ Another</button>
    </div>
  </div>

  <!-- Saved -->
  <div class="saved-section" id="savedSection" style="display:none">
    <div class="saved-header">
      <div class="saved-title">‚≠ê Your best lines</div>
      <button class="clear-btn" onclick="clearAll()">Clear all</button>
    </div>
    <div id="savedList"></div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let selectedType = 'general';
let currentLine = '';
let currentContext = '';
let savedLines = [];

// Load saved lines from localStorage
try { savedLines = JSON.parse(localStorage.getItem('wishid-saved') || '[]'); } catch(e) { savedLines = []; }
renderSaved();

// ‚îÄ‚îÄ Situation type selector ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectType(btn, type) {
  document.querySelectorAll('.type-chip').forEach(c => c.classList.remove('selected'));
  btn.classList.add('selected');
  selectedType = type;
}

// ‚îÄ‚îÄ Lines database ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const linesByType = {
  boss: [
    { line: `Wow, great feedback! I'm going to go home, lie face down on my bed, and think about every decision I've ever made that led me to this moment.`, context: `After being corrected at work` },
    { line: `Absolutely, I'll redo the whole thing. Should I also redo my personality while I'm at it or is that a separate project?`, context: `Told to redo your work` },
    { line: `You're so right. I don't know how I've survived this long. Statistically I should have been weeded out years ago.`, context: `Made to feel incompetent` },
    { line: `Oh that's not what you wanted? Interesting. I'd assumed it was good because I am a golden genius. Apparently not. Updating my files.`, context: `Work gets rejected` },
    { line: `I completely understand. You want it faster, better, cheaper, and delivered by a version of me that has her life together.`, context: `Unreasonable expectations` },
    { line: `Could you put that in an email? I want to screenshot it and send it to myself at 3am as a treat.`, context: `Harsh verbal feedback` },
    { line: `Noted! I've added it to the document titled 'Evidence That I Am, In Fact, The Problem'.`, context: `Criticism that stings` },
    { line: `I'll have that done by Friday. Which Friday is yet to be determined but the intention is very much there.`, context: `Unreasonable deadline` },
    { line: `That's such a good point. Have you ever considered that you're absolutely right and I find that personally offensive?`, context: `Boss is annoyingly correct` },
    { line: `I appreciate your honesty! I would have preferred a lie but honesty is also fine I suppose.`, context: `Blunt feedback` },
    { line: `I'll get right on that! Right after I finish sitting here wondering how I convinced everyone I know what I'm doing.`, context: `Given an impossible task` },
    { line: `Yes, I understand. And I will absolutely pretend to implement that change while doing exactly what I was already doing.`, context: `Told to change your approach` },
  ],
  family: [
    { line: `You're right. I don't know how I've made it this far without a single one of my life choices being approved by this table.`, context: `Family ganging up on you` },
    { line: `Yes, cousin Sharon bought a house at 27. Cousin Sharon also alphabetises her spice rack. We're on different paths and I'm at peace with mine. Mostly.`, context: `Compared to a relative` },
    { line: `Mum I love you so much and if you finish that sentence I'm going to have to go and live in the garden.`, context: `Mum about to say the thing` },
    { line: `That's such a good point and I'm going to think about it every night for the next four years while staring at the ceiling.`, context: `Advice that hits a nerve` },
    { line: `I turned out fine! I mean fine is doing a lot of heavy lifting in that sentence but the core message stands.`, context: `Upbringing being critiqued` },
    { line: `Oh we're doing unsolicited opinions now? Great! I also have some. Should I go first or shall we take turns?`, context: `Everyone has thoughts on your life` },
    { line: `I appreciate that. And I'm going to do the exact opposite and then blame literally everyone except myself.`, context: `Good advice you'll ignore` },
    { line: `You know what, you're right. I've been going about this whole being a person thing completely wrong. I'll start over. How long did it take you?`, context: `Being told how to live` },
    { line: `I hear you. I really do. And I'm choosing to interpret this as love even though it feels a lot like a tribunal.`, context: `Family intervention energy` },
    { line: `Noted! I've filed that next to every other piece of advice I've been collecting since 1994.`, context: `Repeated family advice` },
    { line: `I know I know I know. I am a work in progress. A very slow, chaotic, occasionally impressive work in progress.`, context: `Being reminded of the same thing again` },
    { line: `Dad I love you but this conversation is going to cost me forty dollars in therapy so I'm going to need you to wrap it up.`, context: `Dad giving a speech` },
  ],
  friend: [
    { line: `That is genuinely the most accurate thing anyone has ever said to me and I need you to take it back immediately.`, context: `Friend nails it and you hate it` },
    { line: `You're so right. You are so annoyingly, insufferably right. I hope you're happy. You've ruined my evening.`, context: `When they make a perfect point` },
    { line: `I hear you. I validate you. I'm going to do the exact opposite and then call you crying in approximately eleven days.`, context: `Good advice you won't take` },
    { line: `Bold of you to assume I have a plan. I am being carried entirely by charisma and the sheer audacity of continuing to exist.`, context: `Asked about your plans` },
    { line: `You're my best friend. You are also the primary reason I have trust issues. I say this with love.`, context: `Friend causes chaos` },
    { line: `I'm not avoiding the problem. I'm giving it space to develop a personality and introduce itself to me properly.`, context: `Called out for avoiding something` },
    { line: `That's fair. SO fair. Disgustingly fair. I'm furious at how fair that is.`, context: `Accurate observation` },
    { line: `You know what, I'm going to need you to be slightly less correct slightly less often. For my sake.`, context: `Friend is right again` },
    { line: `I know it looks bad. And it is bad. But it looked worse before so technically this is progress.`, context: `Friend judging your choices` },
    { line: `I appreciate your concern! I'm going to dismiss it completely and then quote you back to myself when it all goes wrong.`, context: `Ignored a warning` },
    { line: `I love you! I love you the way you love a smoke alarm ‚Äî essential, important, and occasionally I want to take the batteries out.`, context: `Overly honest friend` },
    { line: `Wow you said the quiet part out loud AGAIN. It's almost a talent at this point.`, context: `Friend has no filter` },
  ],
  stranger: [
    { line: `Oh thank you! I was worried I'd get through today without a single stranger's assessment of my life and here you are. A miracle.`, context: `Unsolicited stranger opinion` },
    { line: `Wow. You looked at me, a person you have never met, and decided that was the right thing to say. You must sleep so well.`, context: `Rude stranger` },
    { line: `I'm going to smile more when something's funny. You're welcome to wait.`, context: `Told to smile` },
    { line: `That's fascinating! Is this a hobby for you or more of a calling?`, context: `Stranger sharing strong opinions` },
    { line: `I can see you have a lot of thoughts. I hope carrying them isn't too heavy.`, context: `Opinionated stranger` },
    { line: `I appreciate you! The way I appreciate a car alarm ‚Äî you're loud, you're there, and I can't wait until you stop.`, context: `Annoying stranger` },
    { line: `Noted! I'll factor that into my decision making right after I factor in literally everything else including the weather.`, context: `Stranger's advice` },
    { line: `You know I was just standing here being a person and now I'm having a whole experience. Thank you for that.`, context: `Unwanted interaction` },
    { line: `I'm going to walk away now. Not because you're wrong but because I have a limited amount of energy and I've allocated none of it to this.`, context: `Any stranger situation` },
    { line: `That landed interestingly didn't it. It's okay. We've all said something that escaped before we could catch it.`, context: `Stranger says something weird` },
    { line: `You know what, I don't know you, you don't know me, and on reflection I think that's exactly how it should stay.`, context: `Overfamiliar stranger` },
    { line: `Bless you. Genuinely. From here. At this specific distance. Which I am going to increase now.`, context: `Any mildly unhinged stranger` },
  ],
  date: [
    { line: `Oh that's so interesting! Tell me more. Just kidding please stop I'm already mentally redecorating my flat.`, context: `Date talking too much` },
    { line: `You mention your ex a lot! That's great. I love a person with unfinished business. Very relatable. Extremely not a red flag.`, context: `Date mentions ex again` },
    { line: `I'm having such a nice time! That statement becomes more creative the longer this evening goes on.`, context: `Bad date you're enduring` },
    { line: `Wow you really put it all out there on a first date don't you. Brave. Unhinged. But brave.`, context: `Too much information too soon` },
    { line: `I love your confidence. I love that you think this is going well. I find it genuinely inspiring.`, context: `Date who can't read the room` },
    { line: `That's such a good story! It has a beginning, a middle, and me doing complex maths on how long I have to stay before leaving is acceptable.`, context: `Long story on a date` },
    { line: `I'm getting a very clear picture of who you are and I've decided to leave it in landscape and never look at it again.`, context: `Revealing date moment` },
    { line: `You know, I think we want different things. You want someone who's impressed by that. I want to go home and watch television.`, context: `Date showing off` },
    { line: `I had a wonderful evening! Wonderful is doing a lot of work in that sentence but the sentiment is genuine.`, context: `Polite exit from bad date` },
    { line: `I'm free next weekend! To do literally anything other than this but the thought was there wasn't it.`, context: `Asked on a second date you won't go on` },
    { line: `You're great! You're so great. This is going so well. I'm going to go to the bathroom and never come back.`, context: `Date going badly` },
    { line: `I like you! I like you the way I like a film that's fine but I wouldn't watch it again.`, context: `No romantic spark` },
  ],
  general: [
    { line: `I'm going to need a moment. Not a short moment. A long one. Possibly in a different country with a different name.`, context: `Something completely unexpected` },
    { line: `That's such a good point. I'm going to ignore it so thoroughly it'll feel like it was never said.`, context: `When someone's right and you hate it` },
    { line: `I would respond but I've already used up my daily allocation of dealing with things. I'm empty. The tank is dry.`, context: `Too much happening` },
    { line: `Wow, you really committed to that take didn't you. No parachute, no helmet, just full speed directly into being wrong.`, context: `Someone confidently incorrect` },
    { line: `I'm sorry, I was distracted by the extremely loud noise of nobody asking for that.`, context: `Unsolicited opinion` },
    { line: `I'll add that to the pile. The pile is mostly on fire but there's room.`, context: `One more thing to deal with` },
    { line: `You know what's great about this situation? Nothing currently but I've lit a candle and I'm manifesting.`, context: `Things going badly` },
    { line: `I had a whole response but then I remembered I have the emotional bandwidth of a very tired biscuit.`, context: `Can't be bothered arguing` },
    { line: `That landed differently than you intended didn't it. It's okay. Some of us live in that gap between intention and impact. Rent free.`, context: `Awkward comment` },
    { line: `I'm choosing to interpret that as a compliment and physically sprint away before context arrives.`, context: `Ambiguous comment` },
    { line: `Absolutely! Right after I finish my current task of quietly coming apart at the seams.`, context: `Asked to do more things` },
    { line: `I love that you think I have this handled. One of us should and I'm glad it's you.`, context: `When someone assumes you're fine` },
    { line: `I'm not in denial. I'm in a waiting room just outside denial. It's got better lighting.`, context: `Called out for avoiding reality` },
    { line: `That's fair. Genuinely fair. I'm going to be silently furious about it for three to five business days and then quietly agree.`, context: `Accurate criticism` },
    { line: `I respect that opinion! I'm putting it in a little box, closing the lid, and posting it to no address in particular.`, context: `Opinion you're dismissing` },
    { line: `You know what, I think this is one of those situations where we both pretend it didn't happen and grow as people separately.`, context: `Awkward encounter` },
    { line: `I hear you. I really hear you. And I'm choosing to respond with a smile and absolutely nothing else.`, context: `When silence is the best answer` },
  ]
};

// Situation-based response templates
const situationResponses = {
  ignored: [
    `Sorry, I was just mapping out all the ways to exit this conversation.`,
    `Hold on, I'm composing my response in a language you'll actually hear.`,
    `I was going to say something but then I remembered: why bother.`,
  ],
  late: [
    `I'm not late. Everyone else is just aggressively early.`,
    `Time is a social construct and I refuse to be bound by your constructs.`,
    `I was here in spirit the whole time. My body just takes longer.`,
  ],
  boring: [
    `Wow, this is fascinating. I'm so glad I woke up today.`,
    `Please keep going. I'm listening so hard right now.`,
    `I'm riveted. Truly. This is the best use of everyone's time.`,
  ],
  rude: [
    `I'm sorry, I think your filter fell off. Do you need a moment to find it?`,
    `Interesting choice of words! Really bold. Unasked for but bold.`,
    `I'm going to give you the gift of pretending you didn't just say that.`,
  ],
  comparison: [
    `Oh you're comparing me to other people? How original! How classic! How very you!`,
    `Noted! I'll add that to my list of comparisons I didn't ask for and won't be using.`,
    `Wonderful! We're all on different journeys and mine apparently includes this conversation.`,
  ],
};

function detectSituationKeywords(text) {
  const t = text.toLowerCase();
  if (t.includes('ignor') || t.includes('didn\'t listen') || t.includes('not listening')) return 'ignored';
  if (t.includes('late') || t.includes('early') || t.includes('time')) return 'late';
  if (t.includes('boring') || t.includes('long story') || t.includes('wouldn\'t stop talking')) return 'boring';
  if (t.includes('rude') || t.includes('mean') || t.includes('said something') || t.includes('called me')) return 'rude';
  if (t.includes('compared') || t.includes('why can\'t you') || t.includes('should be more like')) return 'comparison';
  return null;
}

function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

let lastIndex = -1;

function getLineForType(type) {
  const lines = linesByType[type] || linesByType.general;
  let idx;
  do { idx = Math.floor(Math.random() * lines.length); } while (idx === lastIndex && lines.length > 1);
  lastIndex = idx;
  return lines[idx];
}

function generate() {
  const input = document.getElementById('situationInput').value.trim();
  
  // Show generating state
  document.getElementById('generating').classList.add('show');
  document.getElementById('resultCard').classList.remove('show');

  setTimeout(() => {
    document.getElementById('generating').classList.remove('show');

    let result;

    if (input.length > 5) {
      // Try to match situation keywords first
      const keyword = detectSituationKeywords(input);
      if (keyword && Math.random() > 0.4) {
        result = {
          line: pick(situationResponses[keyword]),
          context: `For your situation`
        };
      } else {
        result = getLineForType(selectedType);
      }
    } else {
      result = getLineForType(selectedType);
    }

    currentLine = result.line;
    currentContext = result.context;

    document.getElementById('resultText').textContent = result.line;
    document.getElementById('resultContext').textContent = result.context;
    document.getElementById('resultCard').classList.add('show');

  }, 600 + Math.random() * 400);
}

function randomLine() {
  document.getElementById('situationInput').value = '';
  const allTypes = Object.keys(linesByType);
  const randomType = pick(allTypes);
  const result = getLineForType(randomType);
  currentLine = result.line;
  currentContext = result.context;

  document.getElementById('generating').classList.add('show');
  document.getElementById('resultCard').classList.remove('show');

  setTimeout(() => {
    document.getElementById('generating').classList.remove('show');
    document.getElementById('resultText').textContent = result.line;
    document.getElementById('resultContext').textContent = result.context;
    document.getElementById('resultCard').classList.add('show');
  }, 500);
}

// ‚îÄ‚îÄ Save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveLine() {
  if (!currentLine) return;
  if (savedLines.find(s => s.line === currentLine)) { showToast('Already saved! ‚≠ê'); return; }
  savedLines.unshift({ line: currentLine, context: currentContext, type: selectedType });
  localStorage.setItem('wishid-saved', JSON.stringify(savedLines));
  renderSaved();
  showToast('Saved to your best lines! ‚≠ê');
}

function deleteSaved(i) {
  savedLines.splice(i, 1);
  localStorage.setItem('wishid-saved', JSON.stringify(savedLines));
  renderSaved();
}

function clearAll() {
  if (!confirm('Clear all saved lines?')) return;
  savedLines = [];
  localStorage.setItem('wishid-saved', JSON.stringify(savedLines));
  renderSaved();
}

function renderSaved() {
  const section = document.getElementById('savedSection');
  const list = document.getElementById('savedList');
  if (savedLines.length === 0) {
    section.style.display = 'none';
    return;
  }
  section.style.display = 'block';
  list.innerHTML = savedLines.map((s, i) => `
    <div class="saved-item">
      <div style="flex:1">
        <div class="saved-text">${s.line}</div>
        <div class="saved-tag">${s.context}</div>
      </div>
      <button class="del-btn" onclick="deleteSaved(${i})">‚úï</button>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ Copy ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function copyLine() {
  if (!currentLine) return;
  navigator.clipboard.writeText(currentLine).then(() => showToast('Copied! üìã')).catch(() => showToast('Copy failed'));
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// Allow Enter key to generate (but Shift+Enter for new line)
document.getElementById('situationInput').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); generate(); }
});
</script>
</body>
</html>
